<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест: Скорость движения | ПДД Профи</title>
    <link rel="stylesheet" href="css/speed_test.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="test-wrapper">
        <!-- Шапка теста -->
        <header class="test-header">
            <div class="header-left">
                <button class="back-btn" onclick="window.history.back()">
                    <i class="fas fa-arrow-left"></i>
                    Назад
                </button>
                <div class="test-info">
                    <h1>Скорость движения</h1>
                    <div class="test-meta">
                        <span><i class="far fa-clock"></i> 20 минут</span>
                        <span><i class="far fa-question-circle"></i> 29 вопросов</span>
                        <span><i class="fas fa-graduation-cap"></i> 65% успешности</span>
                    </div>
                </div>
            </div>
            
            <div class="header-right">
                <div class="theme-toggle">
                    <button id="testThemeToggle" class="theme-btn" title="Сменить тему">
                        <i class="fas fa-moon"></i>
                        <i class="fas fa-sun"></i>
                    </button>
                </div>
                <div class="timer">
                    <i class="fas fa-stopwatch"></i>
                    <span id="timer">20:00</span>
                </div>
            </div>
        </header>

        <!-- Прогресс -->
        <div class="progress-section">
            <div class="progress-header">
                <span id="questionCounter">Вопрос 1 из 29</span>
                <span id="progressPercent">3%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- Контейнер вопроса -->
        <div id="questionContainer" class="question-container">
            <div class="question-image-wrapper">
                <div class="image-counter">
                    <i class="fas fa-image"></i>
                    <span id="imageCounter">1/29</span>
                </div>
                <img class="question-image" id="questionImage" src="" alt="Дорожная ситуация">
                <div class="image-zoom">
                    <button class="zoom-btn" onclick="zoomImage()">
                        <i class="fas fa-search-plus"></i>
                    </button>
                </div>
            </div>
            
            <div class="question-text-wrapper">
                <div class="question-number">
                    <span>Вопрос</span>
                    <strong id="currentQuestion">1</strong>
                </div>
                <div class="question-text" id="questionText"></div>
            </div>

            <!-- Варианты ответов -->
            <div class="answers-container" id="answersContainer">
                <!-- Ответы будут добавлены через JS -->
            </div>

            <!-- Навигация -->
            <div class="navigation-buttons">
                <button class="nav-btn btn-prev" id="prevBtn" disabled>
                    <i class="fas fa-chevron-left"></i>
                    Предыдущий
                </button>
                
                <div class="nav-status">
                    <span class="status-text" id="statusText">Выберите ответ</span>
                </div>
                
                <button class="nav-btn btn-next" id="nextBtn">
                    Следующий
                    <i class="fas fa-chevron-right"></i>
                </button>
                
                <button class="nav-btn btn-finish" id="finishBtn" style="display: none;">
                    <i class="fas fa-flag-checkered"></i>
                    Завершить тест
                </button>
            </div>
        </div>

        <!-- Контейнер результатов -->
        <div id="resultContainer" class="result-container" style="display: none;">
            <div class="result-header">
                <div class="result-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h2>Тест завершён</h2>
                <p class="result-subtitle">Результаты тестирования</p>
            </div>
            
            <div class="result-score">
                <div class="score-circle">
                    <svg class="progress-ring" width="200" height="200">
                        <circle class="progress-ring-bg" stroke-width="8" fill="transparent" r="90" cx="100" cy="100"/>
                        <circle class="progress-ring-fill" stroke-width="8" fill="transparent" r="90" cx="100" cy="100"/>
                    </svg>
                    <div class="score-content">
                        <div class="score-value" id="scoreValue">0</div>
                        <div class="score-total">из 29</div>
                        <div class="score-percentage" id="scorePercentage">0%</div>
                    </div>
                </div>
            </div>
            
            <div class="result-details">
                <div class="detail-card">
                    <div class="detail-icon correct">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="detail-content">
                        <div class="detail-value" id="correctCount">0</div>
                        <div class="detail-label">Правильных ответов</div>
                    </div>
                </div>
                
                <div class="detail-card">
                    <div class="detail-icon wrong">
                        <i class="fas fa-times"></i>
                    </div>
                    <div class="detail-content">
                        <div class="detail-value" id="wrongCount">0</div>
                        <div class="detail-label">Ошибок</div>
                    </div>
                </div>
                
                <div class="detail-card">
                    <div class="detail-icon time">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="detail-content">
                        <div class="detail-value" id="timeSpent">0:00</div>
                        <div class="detail-label">Затрачено времени</div>
                    </div>
                </div>
            </div>
            
            <div class="result-message" id="resultMessage"></div>
            
            <div class="result-actions">
                <button class="action-btn btn-review" id="reviewBtn">
                    <i class="fas fa-list"></i>
                    Обзор ошибок
                </button>
                <button class="action-btn btn-restart" id="restartBtn">
                    <i class="fas fa-redo"></i>
                    Пройти заново
                </button>
                <button class="action-btn btn-return" id="returnBtn">
                    <i class="fas fa-home"></i>
                    На главную
                </button>
            </div>
        </div>

        <!-- Обзор ошибок -->
        <div id="reviewContainer" class="review-container" style="display: none;">
            <div class="review-header">
                <h2><i class="fas fa-exclamation-circle"></i> Обзор ошибок</h2>
                <p>Вопросы, на которые были даны неверные ответы</p>
            </div>
            
            <div class="review-list" id="reviewList">
                <!-- Ошибки будут добавлены через JS -->
            </div>
            
            <button class="back-btn" onclick="showResults()">
                <i class="fas fa-arrow-left"></i>
                Вернуться к результатам
            </button>
        </div>
    </div>

    <!-- Модальное окно увеличения изображения -->
    <div id="imageModal" class="image-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeImageModal()">
                <i class="fas fa-times"></i>
            </button>
            <img id="modalImage" src="" alt="Увеличенное изображение">
        </div>
    </div>

    <!-- Подключаем скрипты -->
    <script src="data/speed_questions.js"></script>
    <script src="js/speed_test.js"></script>
    <script>
        // Управление темой в тесте
        const testThemeToggle = document.getElementById('testThemeToggle');
        const html = document.documentElement;
        
        testThemeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });
        
        // Установка сохранённой темы
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            html.setAttribute('data-theme', savedTheme);
        }
        
        // Функции для модального окна изображения
        function zoomImage() {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const questionImg = document.getElementById('questionImage');
            
            modalImg.src = questionImg.src;
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Закрытие модального окна при клике вне изображения
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeImageModal();
            }
        });
        
        // Функции для переключения между результатами и обзором ошибок
        function showResults() {
            document.getElementById('reviewContainer').style.display = 'none';
            document.getElementById('resultContainer').style.display = 'block';
        }
    </script>
</body>
</html>